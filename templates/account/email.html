{% extends "base.html" %}

{% block extra_css %}
<style>
  .auth-form .row { align-items: center; }
  .auth-form label.col-form-label { min-width: 170px; }
  .auth-form .field-col { max-width: 520px; }
  .auth-form input[type="email"] { width: 100%; }
  @media (max-width: 576px) {
    .auth-form label.col-form-label { min-width: 0; }
  }
  .auth-form input { padding: .5rem .75rem; border: 1px solid var(--bs-border-color); border-radius: .375rem; background: var(--bs-body-bg); color: var(--bs-body-color); }
  .auth-form input:focus { outline: 0; box-shadow: 0 0 0 .25rem rgba(13,110,253,.25); border-color: var(--bs-primary); }
  .auth-form .errorlist { color: var(--bs-danger); margin: .25rem 0 0; }
  .auth-form .errorlist li { list-style: none; }
  .email-list { list-style: none; padding: 0; }
  .email-list li { padding: 1rem; margin-bottom: 1rem; border: 1px solid var(--bs-border-color); border-radius: .375rem; background: var(--bs-body-bg); }
  .email-list .btn { margin-right: 0.5rem; margin-bottom: 0.5rem; }
  .badge { padding: 0.5rem 0.75rem; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2>Email Addresses</h2>
  
  {% if emailaddresses %}
    <div class="mt-4">
      <p>The following email addresses are associated with your account:</p>
      <ul class="email-list">
        {% for emailaddress in emailaddresses %}
          <li>
            <form method="post" action="{% url 'account_email' %}" class="d-inline">
              {% csrf_token %}
              <input type="radio" name="email" value="{{ emailaddress.email }}" 
                     {% if emailaddress.primary %}checked="checked"{% endif %}>
              <strong>{{ emailaddress.email }}</strong>
              
              {% if emailaddress.verified %}
                <span class="badge bg-success ms-2">Verified</span>
              {% else %}
                <span class="badge bg-warning text-dark ms-2">Unverified</span>
              {% endif %}
              
              {% if emailaddress.primary %}
                <span class="badge bg-primary ms-2">Primary</span>
              {% endif %}
              
              <div class="mt-2">
                {% if not emailaddress.primary %}
                  <button type="submit" name="action_primary" class="btn btn-sm btn-primary">Make Primary</button>
                {% endif %}
                
                {% if not emailaddress.verified %}
                  <button type="submit" name="action_send" class="btn btn-sm btn-secondary">Re-send Verification</button>
                {% endif %}
                
                <button type="submit" name="action_remove" class="btn btn-sm btn-danger"
                        {% if emailaddress.primary %}disabled{% endif %}>Remove</button>
              </div>
            </form>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% else %}
    <p class="mt-3">You currently have no email addresses associated with your account.</p>
  {% endif %}

  <hr class="my-4">

  <h3>Add Email Address</h3>
  <form method="post" action="{% url 'account_email' %}" class="auth-form mt-3">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="row mb-3">
      <label for="{{ form.email.id_for_label }}" class="col-form-label">Email</label>
      <div class="field-col">
        {{ form.email }}
        {% if form.email.errors %}
          <ul class="errorlist">{% for e in form.email.errors %}<li>{{ e }}</li>{% endfor %}</ul>
        {% endif %}
      </div>
    </div>

    <div class="row">
      <label class="col-form-label"></label>
      <div class="field-col">
        <button type="submit" name="action_add" class="btn btn-success">Add Email</button>
      </div>
    </div>
  </form>

  <div class="mt-4">
    <a href="/" class="btn btn-secondary">Back to Home</a>
  </div>
</div>
{% endblock %}
