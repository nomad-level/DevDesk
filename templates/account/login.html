{% extends "base.html" %}
{% load socialaccount %}
{% load auth_extras %}

{% block extra_css %}
<style>
  .auth-form .row { align-items: center; }
  .auth-form label.col-form-label { min-width: 170px; }
  .auth-form .field-col { max-width: 520px; }
  .auth-form input[type="email"],
  .auth-form input[type="password"] { width: 100%; }
  .auth-actions { margin-left: 170px; }
  @media (max-width: 576px) {
    .auth-form label.col-form-label { min-width: 0; }
    .auth-actions { margin-left: 0; }
  }
  .auth-form input { padding: .5rem .75rem; border: 1px solid var(--bs-border-color); border-radius: .375rem; background: var(--bs-body-bg); color: var(--bs-body-color); }
  .auth-form input:focus { outline: 0; box-shadow: 0 0 0 .25rem rgba(13,110,253,.25); border-color: var(--bs-primary); }
  .auth-form .errorlist { color: var(--bs-danger); margin: .25rem 0 0; }
  .auth-form .errorlist li { list-style: none; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2>Login</h2>
  <form method="post" action="{% url 'account_login' %}" class="auth-form mt-3">
    {% csrf_token %}
    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="row mb-3">
      <label for="{{ form.login.id_for_label }}" class="col-form-label">Email</label>
      <div class="field-col">
        {{ form.login }}
        {% if form.login.errors %}
          <ul class="errorlist">{% for e in form.login.errors %}<li>{{ e }}</li>{% endfor %}</ul>
        {% endif %}
      </div>
    </div>

    <div class="row mb-4">
      <label for="{{ form.password.id_for_label }}" class="col-form-label">Password</label>
      <div class="field-col">
        {{ form.password }}
        {% if form.password.errors %}
          <ul class="errorlist">{% for e in form.password.errors %}<li>{{ e }}</li>{% endfor %}</ul>
        {% endif %}
        <div class="d-flex justify-content-end mt-2">
          <button type="submit" class="btn btn-primary">Login</button>
        </div>
        {% if redirect_field_value %}
          <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
        {% endif %}
      </div>
    </div>
  </form>
  
  <div class="mt-3 auth-form">
    <div class="row">
      <label class="col-form-label"></label>
      <div class="field-col">
        <div style="width: 100%; display: flex; justify-content: center; gap: 0.5rem; flex-wrap: wrap;">
          {% has_social_app 'google' as google_enabled %}
          {% has_social_app 'github' as github_enabled %}
          {% if google_enabled %}
            <a href="{% provider_login_url 'google' %}" class="btn btn-danger">Login with Google</a>
          {% else %}
            <button class="btn btn-danger" type="button" disabled title="Enable Google OAuth in Admin to activate">Login with Google</button>
          {% endif %}
          {% if github_enabled %}
            <a href="{% provider_login_url 'github' %}" class="btn btn-secondary">Login with GitHub</a>
          {% else %}
            <button class="btn btn-secondary" type="button" disabled title="Enable GitHub OAuth in Admin to activate">Login with GitHub</button>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  <div class="mt-3 auth-form">
    <div class="row">
      <label class="col-form-label"></label>
      <div class="field-col">
        <div style="width: 100%; text-align: center;">
          <a href="{% url 'account_signup' %}">Don't have an account? Sign up</a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
